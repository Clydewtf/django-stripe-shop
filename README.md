# Django Stripe Shop
Реализация тестового задания (Django + Stripe API бэкенд)
Просмотр товаров, оформление тестовой оплаты через Stripe (товары добавляются через админку)

## Реализовано
- Django Модель Item с полями (name, description, price, currency)
- Страница товара /item/{id} с информацией о нем и кнопкой покупки
- Метод /buy/{id} возвращает Stripe Session Id для последующего редиректа на Stripe Checkout
- Запуск используя Docker (локально и build через docker в Railway)
- Использование environment variables (.env с ключами и настройками локально и service variables в Railway)
- Просмотр Django Моделей в Django Admin панели
- Запуск на удаленном сервере (используется Railway)
- Поле Item.currency для поддержки разных валют (т.к Stripe мультивалютный, то он автоматически предлагает оплату в выбранной валюте: если товар в USD - оплата в USD / в EUR - оплата в EUR)

## Запуск онлайн
Приложение доступно по ссылке (для просмотра товаров добавить item/{id} - создано 2 товара в USD и EUR - item/4 и item/5):  
https://django-stripe-shop-production.up.railway.app/

Ссылка на админку:  
https://django-stripe-shop-production.up.railway.app/admin

Данные от админки:  
login: admin  
password: admin

## Запуск локально
```bash
git clone https://github.com/Clydewtf/django-stripe-shop.git
cd gjango-stripe-shop

copy .env.example .env

docker-compose up --build  
```
Приложение будет доступно по ссылке (для просмотра товаров добавить item/{id} - создано 2 товара в USD и EUR - item/1 и item/2):  
http://localhost:8000/

Админка:  
добавить /admin к ссылке

Данные от админки:  
login: admin  
password: admin

## Тестирование оплаты
1. Зайти на <ссылка на приложение (онлайн/локально)>/item/<4 или 5 (онлайн), 1 или 2 (локально)>
2. Нажать Buy (произойдет редирект на Stripe Checkout)
3. Ввести тестовые данные карты (например 4242 4242 4242 4242, 12/28, 123)
4. Через <ссылка на приложение (онлайн/локально)>/admin можно добавить свой товары

## Что можно улучшить / добавить
1. Создать 2 аккаунта Stripe для того, чтобы сделать 2 Stripe Keypair на две разные валюты, и в зависимости от валюты товара через отдельный метод выбирать нужный stripe.api_key для создания checkout session в методе create_checkout_session (т.к Stripe мультивалютный и оплата уже предлагается в валюте товара, 2 аккаунта решил не создавать)
2. Добавить модель Order для объединения нескольких Items в один "заказ", платеж в Stripe на содержимое Order с общей стоимостью. Т.к товары могут быть в разной валюте, нужно было бы в лучшем случае добавить обращение к api курсам валют и приводить все товары в Order к базовой валюте
3. Добавить Discount, Tax, которые прикрепляются к Order. Через панель Stripe или api создать/получить Id налогов/скидок и передавать его при создании checkout session, тем самым налоги и скидки будут корректно отображаться в Stripe Checkout форме
4. Реализовать Stripe Payment Intent вместо Stripe Session для более гибкой работы с платежами используя stripe.PaymentIntent.create вместо stripe.checkout.Session.create. Это даст больше контроля и возможностей над процессом платежей, кастомизацией, но придется писать свой фронт и дополнительную логику